{# ============================================================
   Macro récursive : rend un item de nav (lien, label ou dropdown)
   link.label     → toujours non-vide (garanti par le JS)
   link.hasImage  → booléen (garanti par le JS)
   link.hasSubItems → booléen (garanti par le JS)
   ============================================================ #}
{% macro renderNavItem(link, currentUrl, currentLang) %}
<li>
{% if link.hasSubItems %}
    {# --- Dropdown (sous-menu) --- #}
    <details class="dropdown">
        <summary>
            {% if link.hasImage %}<img src="{{link.imageSrc}}" alt="{{link.label}}" />{% endif %}{{link.label}}
        </summary>
        <ul>
        {% for sub in link.subItems %}
            {{ renderNavItem(sub, currentUrl, currentLang) }}
        {% endfor %}
        </ul>
    </details>
{% elif link.url %}
    {# --- Lien simple --- #}
    <a href="{{link.url}}" hreflang="{{currentLang}}"
        {% if link.url == currentUrl %}aria-current="page"{% endif %}
    >
        {% if link.hasImage %}<img src="{{link.imageSrc}}" alt="{{link.label}}" class="icon"/>{% endif %}{{link.label}}
    </a>
{% else %}
    {# --- Label (non cliquable) --- #}
    {{link.label}}
{% endif %}
</li>
{% endmacro %}

{% if nav | length %}

<header>
    <nav class="cluster" style="--justify-cluster: space-between">
    <!-- Main pages navigation -->
    {% for navItem in nav %}
    <ul role="list" class="cluster" style="list-style: none; padding: 0; margin: 0">
        {% for link in navItem.groups %}
        {{ renderNavItem(link, page.url, lang) }}
        {% endfor %}
    </ul>
    {% endfor %}


    <!-- Language navigation -->
    {% if page.url | locale_links | length %}
    <ul role="list" id="lang-nav" class="cluster" style="list-style: none; padding: 0; margin: 0">
        {% for link in page.url | locale_links("all") %}
        <li>
        <a
            href="{{link.url}}"
            hreflang="{{link.lang}}"
            aria-current="{{ 'page' if link.lang === lang else 'false' }}"
            ><abbr lang="{{link.lang}}" title="{{link.label}}"
            >{{link.lang | upper}}</abbr></a>
        </li>
        {% endfor %}
    </ul>
    {% endif %}
    </nav>

</header>
{% endif %}

{% css %}
img {
    display: inline-block;
}
{% endcss %}